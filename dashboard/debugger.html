<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMNI-MIND Dashboard Debugger</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 32px;
            font-size: 14px;
        }

        .test-section {
            margin-bottom: 32px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .test-section h2 {
            font-size: 18px;
            color: #333;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-result {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .test-result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .test-result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .test-result.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .test-result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 12px;
            margin-bottom: 12px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .icon {
            font-size: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.green {
            background: #28a745;
        }

        .status-indicator.red {
            background: #dc3545;
        }

        .status-indicator.yellow {
            background: #ffc107;
        }

        code {
            background: #2d3748;
            color: #68d391;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .summary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 32px;
        }

        .summary h3 {
            margin-bottom: 12px;
            font-size: 20px;
        }

        .summary ul {
            list-style: none;
            padding-left: 0;
        }

        .summary li {
            padding: 8px 0;
            font-size: 14px;
        }

        .copy-btn {
            background: #28a745;
            font-size: 12px;
            padding: 8px 16px;
        }

        .copy-btn:hover {
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç OMNI-MIND Dashboard Debugger</h1>
        <p class="subtitle">This tool will test your dashboard deployment and identify issues</p>

        <div style="margin-bottom: 24px;">
            <button onclick="runAllTests()">‚ñ∂Ô∏è Run All Tests</button>
            <button onclick="copyResults()" class="copy-btn">üìã Copy Results</button>
        </div>

        <div id="results"></div>

        <div id="summary" style="display: none;" class="summary">
            <h3>üìä Summary</h3>
            <ul id="summaryList"></ul>
        </div>
    </div>

    <script>
        const DASHBOARD_URL = 'https://alamotte1956.github.io/omnimind/dashboard/';
        const API_URL = 'https://omnimind-production.up.railway.app';
        
        let testResults = [];

        async function runAllTests() {
            testResults = [];
            document.getElementById('results').innerHTML = '';
            document.getElementById('summary').style.display = 'none';

            await testFileAccess();
            await testAPIConnection();
            testLocalStorage();
            testDOMElements();
            
            showSummary();
        }

        function addResult(section, title, status, message) {
            const result = { section, title, status, message };
            testResults.push(result);

            let sectionDiv = document.querySelector(`[data-section="${section}"]`);
            if (!sectionDiv) {
                sectionDiv = document.createElement('div');
                sectionDiv.className = 'test-section';
                sectionDiv.setAttribute('data-section', section);
                sectionDiv.innerHTML = `<h2><span class="icon">üì¶</span> ${section}</h2>`;
                document.getElementById('results').appendChild(sectionDiv);
            }

            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            
            let indicator = '';
            if (status === 'success') indicator = '<span class="status-indicator green"></span>';
            else if (status === 'error') indicator = '<span class="status-indicator red"></span>';
            else if (status === 'warning') indicator = '<span class="status-indicator yellow"></span>';
            
            resultDiv.innerHTML = `${indicator}<strong>${title}:</strong><br>${message}`;
            sectionDiv.appendChild(resultDiv);
        }

        async function testFileAccess() {
            const files = [
                { name: 'app.js', path: 'app.js' },
                { name: 'styles.css', path: 'styles.css' },
                { name: 'index.html', path: 'index.html' },
                { name: 'create-campaign.html', path: 'create-campaign.html' }
            ];

            for (const file of files) {
                try {
                    const response = await fetch(DASHBOARD_URL + file.path, { method: 'HEAD' });
                    
                    if (response.ok) {
                        addResult(
                            'File Access',
                            `‚úÖ ${file.name}`,
                            'success',
                            `Status: ${response.status} OK - File is accessible at ${DASHBOARD_URL}${file.path}`
                        );
                    } else {
                        addResult(
                            'File Access',
                            `‚ùå ${file.name}`,
                            'error',
                            `Status: ${response.status} ${response.statusText} - File not found! GitHub Pages may not be serving this file.`
                        );
                    }
                } catch (error) {
                    addResult(
                        'File Access',
                        `‚ùå ${file.name}`,
                        'error',
                        `Network error: ${error.message} - Cannot reach GitHub Pages.`
                    );
                }
            }
        }

        async function testAPIConnection() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    addResult(
                        'Backend API',
                        '‚úÖ API Health Check',
                        'success',
                        `Backend is online! Version: ${data.version || 'unknown'} - ${data.message}`
                    );
                } else {
                    addResult(
                        'Backend API',
                        '‚ùå API Health Check',
                        'error',
                        `API returned status ${response.status}: ${response.statusText}`
                    );
                }
            } catch (error) {
                addResult(
                    'Backend API',
                    '‚ùå API Health Check',
                    'error',
                    `Cannot reach backend: ${error.message} - Railway may be down or URL is incorrect.`
                );
            }

            // Test campaigns endpoint
            try {
                const response = await fetch(`${API_URL}/api/campaigns`, {
                    headers: {
                        'Authorization': 'Bearer test_token'
                    }
                });
                
                if (response.status === 401) {
                    addResult(
                        'Backend API',
                        '‚úÖ Campaigns Endpoint',
                        'success',
                        'Endpoint exists and requires authentication (expected behavior)'
                    );
                } else if (response.ok) {
                    addResult(
                        'Backend API',
                        '‚ö†Ô∏è Campaigns Endpoint',
                        'warning',
                        'Endpoint accessible without authentication - auth may be disabled'
                    );
                } else {
                    addResult(
                        'Backend API',
                        '‚ùå Campaigns Endpoint',
                        'error',
                        `Unexpected status: ${response.status}`
                    );
                }
            } catch (error) {
                addResult(
                    'Backend API',
                    '‚ùå Campaigns Endpoint',
                    'error',
                    `Cannot test endpoint: ${error.message}`
                );
            }
        }

        function testLocalStorage() {
            try {
                const token = localStorage.getItem('omni_mind_token');
                const user = localStorage.getItem('omni_mind_user');

                if (token) {
                    addResult(
                        'Browser Storage',
                        '‚úÖ JWT Token',
                        'success',
                        `Token exists in localStorage (length: ${token.length} chars)`
                    );
                } else {
                    addResult(
                        'Browser Storage',
                        '‚ÑπÔ∏è JWT Token',
                        'info',
                        'No token found - you need to login first'
                    );
                }

                if (user) {
                    const userData = JSON.parse(user);
                    addResult(
                        'Browser Storage',
                        '‚úÖ User Data',
                        'success',
                        `User logged in: ${userData.name || 'unknown'} (${userData.email || 'no email'})`
                    );
                } else {
                    addResult(
                        'Browser Storage',
                        '‚ÑπÔ∏è User Data',
                        'info',
                        'No user data found - you need to login first'
                    );
                }
            } catch (error) {
                addResult(
                    'Browser Storage',
                    '‚ùå LocalStorage Test',
                    'error',
                    `Error accessing localStorage: ${error.message}`
                );
            }
        }

        function testDOMElements() {
            // Check if we're on a dashboard page
            const currentPage = window.location.href;
            
            addResult(
                'Current Page',
                '‚ÑπÔ∏è Location',
                'info',
                `You are running this debugger from: <code>${currentPage}</code>`
            );

            // Test if we can access the dashboard
            if (currentPage.includes('github.io') || currentPage.includes('localhost')) {
                addResult(
                    'Current Page',
                    '‚úÖ Valid Domain',
                    'success',
                    'You are running from a valid web server (GitHub Pages or localhost)'
                );
            } else {
                addResult(
                    'Current Page',
                    '‚ö†Ô∏è File Protocol',
                    'warning',
                    'You may be running from file:// - some features require a web server'
                );
            }
        }

        function showSummary() {
            const summary = document.getElementById('summary');
            const summaryList = document.getElementById('summaryList');
            
            summary.style.display = 'block';
            summaryList.innerHTML = '';

            const successCount = testResults.filter(r => r.status === 'success').length;
            const errorCount = testResults.filter(r => r.status === 'error').length;
            const warningCount = testResults.filter(r => r.status === 'warning').length;

            summaryList.innerHTML = `
                <li>‚úÖ Passed: ${successCount} tests</li>
                <li>‚ùå Failed: ${errorCount} tests</li>
                <li>‚ö†Ô∏è Warnings: ${warningCount} tests</li>
                <li style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.3);">
                    ${errorCount === 0 ? 'üéâ All critical tests passed!' : '‚ö†Ô∏è Please review the failed tests above'}
                </li>
            `;
        }

        function copyResults() {
            let text = '=== OMNI-MIND Dashboard Debug Report ===\n\n';
            
            testResults.forEach(result => {
                text += `[${result.section}] ${result.title}\n`;
                text += `${result.message}\n\n`;
            });

            text += `\n=== Generated: ${new Date().toLocaleString()} ===`;

            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Results copied to clipboard! Paste this in your message to the developer.');
            }).catch(err => {
                alert('‚ùå Could not copy to clipboard. Please manually copy the results from the screen.');
            });
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 500);
        });
    </script>
</body>
</html>
