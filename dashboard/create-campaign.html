<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Campaign - OMNI-MIND</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>ğŸ§  OMNI-MIND</h1>
                <p>AI Campaign Platform</p>
            </div>
            
            <nav class="nav-menu">
                <a href="index.html" class="nav-item">
                    <span class="icon">ğŸ“Š</span>
                    <span>Dashboard</span>
                </a>
                <a href="campaigns.html" class="nav-item">
                    <span class="icon">ğŸ¯</span>
                    <span>Campaigns</span>
                </a>
                <a href="create-campaign.html" class="nav-item active">
                    <span class="icon">â•</span>
                    <span>New Campaign</span>
                </a>
                <a href="profile.html" class="nav-item">
                    <span class="icon">ğŸ‘¤</span>
                    <span>Profile</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <button id="logoutBtn" class="logout-btn">ğŸšª Logout</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="page-header">
                <h2>Create New Campaign</h2>
            </div>

            <!-- Campaign Form -->
            <form id="createCampaignForm">
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>ğŸ“‹ Basic Information</h3>
                    
                    <div class="form-group">
                        <label for="campaignName">Campaign Name *</label>
                        <input 
                            type="text" 
                            id="campaignName" 
                            name="name"
                            required 
                            placeholder="e.g., Summer Product Launch 2024"
                            minlength="3"
                        >
                    </div>

                    <div class="form-group">
                        <label for="campaignType">Campaign Type *</label>
                        <select id="campaignType" name="type" required>
                            <option value="">Select campaign type</option>
                            <option value="product-launch">ğŸš€ Product Launch</option>
                            <option value="brand-awareness">ğŸ“¢ Brand Awareness</option>
                            <option value="lead-generation">ğŸ¯ Lead Generation</option>
                            <option value="event-promotion">ğŸ‰ Event Promotion</option>
                            <option value="content-marketing">ğŸ“ Content Marketing</option>
                            <option value="social-media">ğŸ“± Social Media Campaign</option>
                            <option value="other">ğŸ”§ Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="campaignDescription">Campaign Description *</label>
                        <textarea 
                            id="campaignDescription" 
                            name="description"
                            required 
                            rows="6"
                            placeholder="Describe your campaign goals, target audience, key messages, and any specific requirements..."
                            minlength="50"
                        ></textarea>
                        <small class="form-hint">Minimum 50 characters. The more detailed your description, the better the AI-generated content.</small>
                    </div>
                </div>

                <!-- AI Tools Selection -->
                <div class="form-section">
                    <h3>ğŸ¤– AI Tools Selection</h3>
                    <p style="color: var(--gray-600); margin-bottom: var(--spacing-lg);">
                        Select which AI services to use for generating your campaign content
                    </p>
                    
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="aiChatGPT" name="ai_tools" value="chatgpt" checked>
                            <label for="aiChatGPT" style="flex: 1; cursor: pointer;">
                                <strong>ğŸ¤– ChatGPT-4</strong><br>
                                <small style="color: var(--gray-600);">Generate blog posts, social media content, and ad copy</small>
                            </label>
                        </div>

                        <div class="checkbox-item">
                            <input type="checkbox" id="aiClaude" name="ai_tools" value="claude">
                            <label for="aiClaude" style="flex: 1; cursor: pointer;">
                                <strong>ğŸ§  Claude 3.5 Sonnet</strong><br>
                                <small style="color: var(--gray-600);">Advanced content strategy and creative writing</small>
                            </label>
                        </div>

                        <div class="checkbox-item">
                            <input type="checkbox" id="aiGemini" name="ai_tools" value="gemini">
                            <label for="aiGemini" style="flex: 1; cursor: pointer;">
                                <strong>âœ¨ Google Gemini 1.5 Pro</strong><br>
                                <small style="color: var(--gray-600);">Comprehensive content analysis and generation</small>
                            </label>
                        </div>

                        <div class="checkbox-item">
                            <input type="checkbox" id="aiDalle" name="ai_tools" value="dalle" checked>
                            <label for="aiDalle" style="flex: 1; cursor: pointer;">
                                <strong>ğŸ¨ DALL-E 3</strong><br>
                                <small style="color: var(--gray-600);">Generate high-quality marketing images</small>
                            </label>
                        </div>

                        <div class="checkbox-item">
                            <input type="checkbox" id="aiElevenLabs" name="ai_tools" value="elevenlabs">
                            <label for="aiElevenLabs" style="flex: 1; cursor: pointer;">
                                <strong>ğŸ™ï¸ ElevenLabs</strong><br>
                                <small style="color: var(--gray-600);">Create professional voiceovers and audio content</small>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Error/Success Messages -->
                <div id="createError" class="error-message" style="display: none; margin-bottom: var(--spacing-lg);"></div>
                <div id="createSuccess" class="success-message" style="display: none; margin-bottom: var(--spacing-lg);"></div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <a href="campaigns.html" class="btn btn-cancel">Cancel</a>
                    <button type="submit" class="btn btn-primary" id="createBtn">
                        <span class="btn-text">Create Campaign</span>
                        <span class="btn-loader" style="display: none;">â³ Creating...</span>
                    </button>
                </div>
            </form>
        </main>
    </div>

    <script src="app.js"></script>
    <script>
        // ========================================
        // Create Campaign Logic
        // ========================================

        document.addEventListener('DOMContentLoaded', () => {
            // Check authentication
            if (!requireAuth()) return;

            // Handle form submission
            const form = document.getElementById('createCampaignForm');
            form.addEventListener('submit', handleCreateCampaign);
        });

        async function handleCreateCampaign(e) {
            e.preventDefault();

            // Get form data
            const name = document.getElementById('campaignName').value.trim();
            const type = document.getElementById('campaignType').value;
            const description = document.getElementById('campaignDescription').value.trim();

            // Get selected AI tools
            const aiToolsCheckboxes = document.querySelectorAll('input[name="ai_tools"]:checked');
            const ai_tools = Array.from(aiToolsCheckboxes).map(cb => cb.value);

            // Validation
            if (!name || !type || !description) {
                showError('createError', 'Please fill in all required fields');
                return;
            }

            if (description.length < 50) {
                showError('createError', 'Campaign description must be at least 50 characters');
                return;
            }

            if (ai_tools.length === 0) {
                showError('createError', 'Please select at least one AI tool');
                return;
            }

            // Set loading state
            setLoadingState('createBtn', true);

            try {
                // Create campaign
                // Backend expects 'brief' not 'description'
                const response = await ApiClient.post(API_CONFIG.ENDPOINTS.CAMPAIGNS, {
                    name,
                    type,
                    brief: description,  // Backend uses 'brief' field
                    ai_tools
                });

                showSuccess('createSuccess', 'Campaign created successfully! Redirecting...');

                // Ask if user wants to process immediately
                setTimeout(() => {
                    if (confirm('Campaign created! Do you want to start processing it now?')) {
                        // Start processing
                        ApiClient.post(API_CONFIG.ENDPOINTS.PROCESS_CAMPAIGN(response.campaign.id))
                            .then(() => {
                                window.location.href = `campaign-details.html?id=${response.campaign.id}`;
                            })
                            .catch(err => {
                                console.error('Failed to process:', err);
                                window.location.href = 'campaigns.html';
                            });
                    } else {
                        window.location.href = 'campaigns.html';
                    }
                }, 1000);

            } catch (error) {
                console.error('Create campaign error:', error);
                showError('createError', error.message || 'Failed to create campaign');
                setLoadingState('createBtn', false);
            }
        }
    </script>
</body>
</html>
